!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.lensCore=e()}(this,function(){"use strict";"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n=e(function(t,e){!function(){function h(o,i,s){o.addEventListener("message",function(t){var e=t.data,n=e.id;if("RPC"===e.type&&null!=n)if(e.method){var r=i[e.method];null==r?o.postMessage({type:"RPC",id:n,error:"NO_SUCH_METHOD"}):Promise.resolve().then(function(){return r.apply(null,e.params)}).then(function(t){o.postMessage({type:"RPC",id:n,result:t})}).catch(function(t){o.postMessage({type:"RPC",id:n,error:""+t})})}else{var a=s[n];if(null==a)throw Error("Unknown callback "+n);delete s[n],e.error?a[1](Error(e.error)):a[0](e.result)}})}function r(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n}e.getCanvas=r,e.convertImageDataToCanvasURL=function(t){var e=window.document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.putImageData(t,0,0),e.toDataURL()},e.applyFilter=function(t){var e=t.data,n=t.transform,i=t.options,s=t.nWorkers,c=function(t,e){var n,o,i,r=this,a={},s="__xpo"+Math.random().toString().substring(2)+"__";"function"==typeof t&&(t="("+Function.prototype.toString.call(t)+")("+s+")"),o=s,i=a,n=(n=(n=t).replace(/^(\s*)export\s+default\s+/m,function(t,e){return i.default=!0,""+e+o+".default="})).replace(/^(\s*)export\s+((?:async\s*)?function(?:\s*\*)?|const|let|var)(\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,function(t,e,n,r,a){return i[a]=!0,""+e+o+"."+a+"="+n+r+a}),t="var "+o+"={};\n"+n+"\n"+o+";\n("+Function.prototype.toString.call(h)+")(self,"+s+",{})";var c,u=URL.createObjectURL(new Blob([t])),l=new Worker(u,void 0),d=l.terminate,p={},f=0;for(c in l.kill=function(t){l.postMessage({type:"KILL",signal:t}),setTimeout(l.terminate)},l.terminate=function(){URL.revokeObjectURL(u),d.call(r)},l.call=function(r,a){return new Promise(function(t,e){var n="rpc"+ ++f;p[n]=[t,e],l.postMessage({type:"RPC",id:n,method:r,params:a})})},l.rpcMethods={},h(l,l.rpcMethods,p),l.expose=function(t){l[c]=function(){return l.call(t,[].slice.call(arguments))}},a)c in l||l.expose(c);return l}("\n        var transform = "+n+";\n\n        export function execute(canvas, index, length, options) {\n            canvas.data = transform({ \n                data: canvas.data, \n                length: length, \n                options: options\n            });\n\n            return { result: canvas, index: index };\n        }\n    "),u=r(e.width,e.height),l=u.getContext("2d");l.putImageData(e,0,0),s=s||1;var d=Math.floor(u.height/s);return new Promise(function(e){for(var n=0,t=void 0,r=0;r<s;r++){t=d,r+1===s&&(t=u.height-d*r);var a=l.getImageData(0,d*r,u.width,t),o=t*u.width*4;c.execute(a,r,o,i).then(function(t){l.putImageData(t.result,0,d*t.index),++n===s&&e(l.getImageData(0,0,u.width,u.height))})}})}}()}),r=n.getCanvas,a=n.convertImageDataToCanvasURL,o=(n.applyFilter,t(e(function(t,e){var n,r,a,o,i,s;n=e,s=(r={exports:{}}).exports,function(){function h(o,i,s){o.addEventListener("message",function(t){var e=t.data,n=e.id;if("RPC"===e.type&&null!=n)if(e.method){var r=i[e.method];null==r?o.postMessage({type:"RPC",id:n,error:"NO_SUCH_METHOD"}):Promise.resolve().then(function(){return r.apply(null,e.params)}).then(function(t){o.postMessage({type:"RPC",id:n,result:t})}).catch(function(t){o.postMessage({type:"RPC",id:n,error:""+t})})}else{var a=s[n];if(null==a)throw Error("Unknown callback "+n);delete s[n],e.error?a[1](Error(e.error)):a[0](e.result)}})}function r(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n}s.getCanvas=r,s.convertImageDataToCanvasURL=function(t){var e=window.document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.putImageData(t,0,0),e.toDataURL()},s.applyFilter=function(t){var e=t.data,n=t.transform,i=t.options,s=t.nWorkers,c=function(t,e){var n,o,i,r=this,a={},s="__xpo"+Math.random().toString().substring(2)+"__";"function"==typeof t&&(t="("+Function.prototype.toString.call(t)+")("+s+")"),o=s,i=a,n=(n=(n=t).replace(/^(\s*)export\s+default\s+/m,function(t,e){return i.default=!0,""+e+o+".default="})).replace(/^(\s*)export\s+((?:async\s*)?function(?:\s*\*)?|const|let|var)(\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,function(t,e,n,r,a){return i[a]=!0,""+e+o+"."+a+"="+n+r+a}),t="var "+o+"={};\n"+n+"\n"+o+";\n("+Function.prototype.toString.call(h)+")(self,"+s+",{})";var c,u=URL.createObjectURL(new Blob([t])),l=new Worker(u,void 0),d=l.terminate,p={},f=0;for(c in l.kill=function(t){l.postMessage({type:"KILL",signal:t}),setTimeout(l.terminate)},l.terminate=function(){URL.revokeObjectURL(u),d.call(r)},l.call=function(r,a){return new Promise(function(t,e){var n="rpc"+ ++f;p[n]=[t,e],l.postMessage({type:"RPC",id:n,method:r,params:a})})},l.rpcMethods={},h(l,l.rpcMethods,p),l.expose=function(t){l[c]=function(){return l.call(t,[].slice.call(arguments))}},a)c in l||l.expose(c);return l}("\n        var transform = "+n+";\n\n        export function execute(canvas, index, length, options) {\n            canvas.data = transform({ \n                data: canvas.data, \n                length: length, \n                options: options\n            });\n\n            return { result: canvas, index: index };\n        }\n    "),u=r(e.width,e.height),l=u.getContext("2d");l.putImageData(e,0,0),s=s||1;var d=Math.floor(u.height/s);return new Promise(function(e){for(var n=0,t=void 0,r=0;r<s;r++){t=d,r+1===s&&(t=u.height-d*r);var a=l.getImageData(0,d*r,u.width,t),o=t*u.width*4;c.execute(a,r,o,i).then(function(t){l.putImageData(t.result,0,d*t.index),++n===s&&e(l.getImageData(0,0,u.width,u.height))})}})}}(),(a=r.exports).getCanvas,a.convertImageDataToCanvasURL,o=a.applyFilter,i=function(t){for(var e=t.data,n=t.length,r=t.options,a=0;a<n;a+=4)e[a]+=r.level,e[a+1]+=r.level,e[a+2]+=r.level;return e},n.transform=i,n.default=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.options,r=t.nWorkers;if(!e||!n||!n.level)throw new Error("lens-filter-brightness:: invalid options provided");return o({data:e,transform:i,options:n,nWorkers:r})},Object.defineProperty(n,"__esModule",{value:!0})}))),i=t(e(function(t,e){var n,r,a,o,i,s;n=e,s=(r={exports:{}}).exports,function(){function h(o,i,s){o.addEventListener("message",function(t){var e=t.data,n=e.id;if("RPC"===e.type&&null!=n)if(e.method){var r=i[e.method];null==r?o.postMessage({type:"RPC",id:n,error:"NO_SUCH_METHOD"}):Promise.resolve().then(function(){return r.apply(null,e.params)}).then(function(t){o.postMessage({type:"RPC",id:n,result:t})}).catch(function(t){o.postMessage({type:"RPC",id:n,error:""+t})})}else{var a=s[n];if(null==a)throw Error("Unknown callback "+n);delete s[n],e.error?a[1](Error(e.error)):a[0](e.result)}})}function r(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n}s.getCanvas=r,s.convertImageDataToCanvasURL=function(t){var e=window.document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.putImageData(t,0,0),e.toDataURL()},s.applyFilter=function(t){var e=t.data,n=t.transform,i=t.options,s=t.nWorkers,c=function(t,e){var n,o,i,r=this,a={},s="__xpo"+Math.random().toString().substring(2)+"__";"function"==typeof t&&(t="("+Function.prototype.toString.call(t)+")("+s+")"),o=s,i=a,n=(n=(n=t).replace(/^(\s*)export\s+default\s+/m,function(t,e){return i.default=!0,""+e+o+".default="})).replace(/^(\s*)export\s+((?:async\s*)?function(?:\s*\*)?|const|let|var)(\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,function(t,e,n,r,a){return i[a]=!0,""+e+o+"."+a+"="+n+r+a}),t="var "+o+"={};\n"+n+"\n"+o+";\n("+Function.prototype.toString.call(h)+")(self,"+s+",{})";var c,u=URL.createObjectURL(new Blob([t])),l=new Worker(u,void 0),d=l.terminate,p={},f=0;for(c in l.kill=function(t){l.postMessage({type:"KILL",signal:t}),setTimeout(l.terminate)},l.terminate=function(){URL.revokeObjectURL(u),d.call(r)},l.call=function(r,a){return new Promise(function(t,e){var n="rpc"+ ++f;p[n]=[t,e],l.postMessage({type:"RPC",id:n,method:r,params:a})})},l.rpcMethods={},h(l,l.rpcMethods,p),l.expose=function(t){l[c]=function(){return l.call(t,[].slice.call(arguments))}},a)c in l||l.expose(c);return l}("\n        var transform = "+n+";\n\n        export function execute(canvas, index, length, options) {\n            canvas.data = transform({ \n                data: canvas.data, \n                length: length, \n                options: options\n            });\n\n            return { result: canvas, index: index };\n        }\n    "),u=r(e.width,e.height),l=u.getContext("2d");l.putImageData(e,0,0),s=s||1;var d=Math.floor(u.height/s);return new Promise(function(e){for(var n=0,t=void 0,r=0;r<s;r++){t=d,r+1===s&&(t=u.height-d*r);var a=l.getImageData(0,d*r,u.width,t),o=t*u.width*4;c.execute(a,r,o,i).then(function(t){l.putImageData(t.result,0,d*t.index),++n===s&&e(l.getImageData(0,0,u.width,u.height))})}})}}(),(a=r.exports).getCanvas,a.convertImageDataToCanvasURL,o=a.applyFilter,i=function(t){for(var u=t.data,e=t.length,n=t.options,r=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},l=function(t,e,n){t[e]=r(n.r)?n.r:t[e],t[e+1]=r(n.g)?n.g:t[e+1],t[e+2]=r(n.b)?n.b:t[e+2],t[e+3]=r(n.a)?n.a:t[e+3]},a=function(c){n.colorsInterval.forEach(function(t){var e,n,r,a,o,i,s=(r=t,a=(e=u)[n=c],o=e[n+1],i=e[n+2],a>=r.from.r&&a<=r.to.r&&o>=r.from.g&&o<=r.to.g&&i>=r.from.b&&i<=r.to.b);s&&t.match?l(u,c,t.match):!s&&t.noMatch&&l(u,c,t.noMatch)})},o=0;o<e;o+=4)a(o);return u},n.transform=i,n.default=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.options,r=t.nWorkers;if(!(e&&n&&n.colorsInterval&&Array.isArray(n.colorsInterval)))throw new Error("lens-filter-color:: invalid options provided");return o({data:e,transform:i,options:n,nWorkers:r})},Object.defineProperty(n,"__esModule",{value:!0})})),s=t(e(function(t,e){var n,r,a,o,i,s;n=e,s=(r={exports:{}}).exports,function(){function h(o,i,s){o.addEventListener("message",function(t){var e=t.data,n=e.id;if("RPC"===e.type&&null!=n)if(e.method){var r=i[e.method];null==r?o.postMessage({type:"RPC",id:n,error:"NO_SUCH_METHOD"}):Promise.resolve().then(function(){return r.apply(null,e.params)}).then(function(t){o.postMessage({type:"RPC",id:n,result:t})}).catch(function(t){o.postMessage({type:"RPC",id:n,error:""+t})})}else{var a=s[n];if(null==a)throw Error("Unknown callback "+n);delete s[n],e.error?a[1](Error(e.error)):a[0](e.result)}})}function r(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n}s.getCanvas=r,s.convertImageDataToCanvasURL=function(t){var e=window.document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.putImageData(t,0,0),e.toDataURL()},s.applyFilter=function(t){var e=t.data,n=t.transform,i=t.options,s=t.nWorkers,c=function(t,e){var n,o,i,r=this,a={},s="__xpo"+Math.random().toString().substring(2)+"__";"function"==typeof t&&(t="("+Function.prototype.toString.call(t)+")("+s+")"),o=s,i=a,n=(n=(n=t).replace(/^(\s*)export\s+default\s+/m,function(t,e){return i.default=!0,""+e+o+".default="})).replace(/^(\s*)export\s+((?:async\s*)?function(?:\s*\*)?|const|let|var)(\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,function(t,e,n,r,a){return i[a]=!0,""+e+o+"."+a+"="+n+r+a}),t="var "+o+"={};\n"+n+"\n"+o+";\n("+Function.prototype.toString.call(h)+")(self,"+s+",{})";var c,u=URL.createObjectURL(new Blob([t])),l=new Worker(u,void 0),d=l.terminate,p={},f=0;for(c in l.kill=function(t){l.postMessage({type:"KILL",signal:t}),setTimeout(l.terminate)},l.terminate=function(){URL.revokeObjectURL(u),d.call(r)},l.call=function(r,a){return new Promise(function(t,e){var n="rpc"+ ++f;p[n]=[t,e],l.postMessage({type:"RPC",id:n,method:r,params:a})})},l.rpcMethods={},h(l,l.rpcMethods,p),l.expose=function(t){l[c]=function(){return l.call(t,[].slice.call(arguments))}},a)c in l||l.expose(c);return l}("\n        var transform = "+n+";\n\n        export function execute(canvas, index, length, options) {\n            canvas.data = transform({ \n                data: canvas.data, \n                length: length, \n                options: options\n            });\n\n            return { result: canvas, index: index };\n        }\n    "),u=r(e.width,e.height),l=u.getContext("2d");l.putImageData(e,0,0),s=s||1;var d=Math.floor(u.height/s);return new Promise(function(e){for(var n=0,t=void 0,r=0;r<s;r++){t=d,r+1===s&&(t=u.height-d*r);var a=l.getImageData(0,d*r,u.width,t),o=t*u.width*4;c.execute(a,r,o,i).then(function(t){l.putImageData(t.result,0,d*t.index),++n===s&&e(l.getImageData(0,0,u.width,u.height))})}})}}(),(a=r.exports).getCanvas,a.convertImageDataToCanvasURL,o=a.applyFilter,i=function(t){for(var e=t.data,n=t.length,r=t.options,a="#"===r.color.charAt(0)?r.color.substr(1):r.color,o=parseInt(a.substr(0,2),16),i=parseInt(a.substr(2,2),16),s=parseInt(a.substr(4,2),16),c=0;c<n;c+=4)e[c]-=(e[c]-o)*(r.level/100),e[c+1]-=(e[c+1]-i)*(r.level/100),e[c+2]-=(e[c+2]-s)*(r.level/100);return e},n.transform=i,n.default=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.options,r=t.nWorkers;if(!(e&&n&&n.color&&n.level))throw new Error("lens-filter-colorize:: invalid options provided");return o({data:e,transform:i,options:n,nWorkers:r})},Object.defineProperty(n,"__esModule",{value:!0})})),c=t(e(function(t,e){var n,r,a,o,i,s;n=e,s=(r={exports:{}}).exports,function(){function h(o,i,s){o.addEventListener("message",function(t){var e=t.data,n=e.id;if("RPC"===e.type&&null!=n)if(e.method){var r=i[e.method];null==r?o.postMessage({type:"RPC",id:n,error:"NO_SUCH_METHOD"}):Promise.resolve().then(function(){return r.apply(null,e.params)}).then(function(t){o.postMessage({type:"RPC",id:n,result:t})}).catch(function(t){o.postMessage({type:"RPC",id:n,error:""+t})})}else{var a=s[n];if(null==a)throw Error("Unknown callback "+n);delete s[n],e.error?a[1](Error(e.error)):a[0](e.result)}})}function r(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n}s.getCanvas=r,s.convertImageDataToCanvasURL=function(t){var e=window.document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.putImageData(t,0,0),e.toDataURL()},s.applyFilter=function(t){var e=t.data,n=t.transform,i=t.options,s=t.nWorkers,c=function(t,e){var n,o,i,r=this,a={},s="__xpo"+Math.random().toString().substring(2)+"__";"function"==typeof t&&(t="("+Function.prototype.toString.call(t)+")("+s+")"),o=s,i=a,n=(n=(n=t).replace(/^(\s*)export\s+default\s+/m,function(t,e){return i.default=!0,""+e+o+".default="})).replace(/^(\s*)export\s+((?:async\s*)?function(?:\s*\*)?|const|let|var)(\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,function(t,e,n,r,a){return i[a]=!0,""+e+o+"."+a+"="+n+r+a}),t="var "+o+"={};\n"+n+"\n"+o+";\n("+Function.prototype.toString.call(h)+")(self,"+s+",{})";var c,u=URL.createObjectURL(new Blob([t])),l=new Worker(u,void 0),d=l.terminate,p={},f=0;for(c in l.kill=function(t){l.postMessage({type:"KILL",signal:t}),setTimeout(l.terminate)},l.terminate=function(){URL.revokeObjectURL(u),d.call(r)},l.call=function(r,a){return new Promise(function(t,e){var n="rpc"+ ++f;p[n]=[t,e],l.postMessage({type:"RPC",id:n,method:r,params:a})})},l.rpcMethods={},h(l,l.rpcMethods,p),l.expose=function(t){l[c]=function(){return l.call(t,[].slice.call(arguments))}},a)c in l||l.expose(c);return l}("\n        var transform = "+n+";\n\n        export function execute(canvas, index, length, options) {\n            canvas.data = transform({ \n                data: canvas.data, \n                length: length, \n                options: options\n            });\n\n            return { result: canvas, index: index };\n        }\n    "),u=r(e.width,e.height),l=u.getContext("2d");l.putImageData(e,0,0),s=s||1;var d=Math.floor(u.height/s);return new Promise(function(e){for(var n=0,t=void 0,r=0;r<s;r++){t=d,r+1===s&&(t=u.height-d*r);var a=l.getImageData(0,d*r,u.width,t),o=t*u.width*4;c.execute(a,r,o,i).then(function(t){l.putImageData(t.result,0,d*t.index),++n===s&&e(l.getImageData(0,0,u.width,u.height))})}})}}(),(a=r.exports).getCanvas,a.convertImageDataToCanvasURL,o=a.applyFilter,i=function(t){for(var e=t.data,n=t.length,r=t.options,a=259*(r.level+255)/(255*(259-r.level)),o=0;o<n;o+=4)e[o]=a*(e[o]-128)+128,e[o+1]=a*(e[o+1]-128)+128,e[o+2]=a*(e[o+2]-128)+128;return e},n.transform=i,n.default=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.options,r=t.nWorkers;if(!e||!n||!n.level)throw new Error("lens-filter-contrast:: invalid options provided");return o({data:e,transform:i,options:n,nWorkers:r})},Object.defineProperty(n,"__esModule",{value:!0})})),u=t(e(function(t,e){var n,r,a,o,i,s;n=e,s=(r={exports:{}}).exports,function(){function h(o,i,s){o.addEventListener("message",function(t){var e=t.data,n=e.id;if("RPC"===e.type&&null!=n)if(e.method){var r=i[e.method];null==r?o.postMessage({type:"RPC",id:n,error:"NO_SUCH_METHOD"}):Promise.resolve().then(function(){return r.apply(null,e.params)}).then(function(t){o.postMessage({type:"RPC",id:n,result:t})}).catch(function(t){o.postMessage({type:"RPC",id:n,error:""+t})})}else{var a=s[n];if(null==a)throw Error("Unknown callback "+n);delete s[n],e.error?a[1](Error(e.error)):a[0](e.result)}})}function r(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n}s.getCanvas=r,s.convertImageDataToCanvasURL=function(t){var e=window.document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.putImageData(t,0,0),e.toDataURL()},s.applyFilter=function(t){var e=t.data,n=t.transform,i=t.options,s=t.nWorkers,c=function(t,e){var n,o,i,r=this,a={},s="__xpo"+Math.random().toString().substring(2)+"__";"function"==typeof t&&(t="("+Function.prototype.toString.call(t)+")("+s+")"),o=s,i=a,n=(n=(n=t).replace(/^(\s*)export\s+default\s+/m,function(t,e){return i.default=!0,""+e+o+".default="})).replace(/^(\s*)export\s+((?:async\s*)?function(?:\s*\*)?|const|let|var)(\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,function(t,e,n,r,a){return i[a]=!0,""+e+o+"."+a+"="+n+r+a}),t="var "+o+"={};\n"+n+"\n"+o+";\n("+Function.prototype.toString.call(h)+")(self,"+s+",{})";var c,u=URL.createObjectURL(new Blob([t])),l=new Worker(u,void 0),d=l.terminate,p={},f=0;for(c in l.kill=function(t){l.postMessage({type:"KILL",signal:t}),setTimeout(l.terminate)},l.terminate=function(){URL.revokeObjectURL(u),d.call(r)},l.call=function(r,a){return new Promise(function(t,e){var n="rpc"+ ++f;p[n]=[t,e],l.postMessage({type:"RPC",id:n,method:r,params:a})})},l.rpcMethods={},h(l,l.rpcMethods,p),l.expose=function(t){l[c]=function(){return l.call(t,[].slice.call(arguments))}},a)c in l||l.expose(c);return l}("\n        var transform = "+n+";\n\n        export function execute(canvas, index, length, options) {\n            canvas.data = transform({ \n                data: canvas.data, \n                length: length, \n                options: options\n            });\n\n            return { result: canvas, index: index };\n        }\n    "),u=r(e.width,e.height),l=u.getContext("2d");l.putImageData(e,0,0),s=s||1;var d=Math.floor(u.height/s);return new Promise(function(e){for(var n=0,t=void 0,r=0;r<s;r++){t=d,r+1===s&&(t=u.height-d*r);var a=l.getImageData(0,d*r,u.width,t),o=t*u.width*4;c.execute(a,r,o,i).then(function(t){l.putImageData(t.result,0,d*t.index),++n===s&&e(l.getImageData(0,0,u.width,u.height))})}})}}(),(a=r.exports).getCanvas,a.convertImageDataToCanvasURL,o=a.applyFilter,i=function(t){for(var e=t.data,n=t.length,r=t.options,a=0;a<n;a+=4)e[a]=255*Math.pow(e[a]/255,r.level),e[a+1]=255*Math.pow(e[a+1]/255,r.level),e[a+2]=255*Math.pow(e[a+2]/255,r.level);return e},n.transform=i,n.default=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.options,r=t.nWorkers;if(!e||!n||!n.level)throw new Error("lens-filter-gamma:: invalid options provided");return o({data:e,transform:i,options:n,nWorkers:r})},Object.defineProperty(n,"__esModule",{value:!0})})),l=t(e(function(t,e){var n,r,a,o,i,s;n=e,s=(r={exports:{}}).exports,function(){function h(o,i,s){o.addEventListener("message",function(t){var e=t.data,n=e.id;if("RPC"===e.type&&null!=n)if(e.method){var r=i[e.method];null==r?o.postMessage({type:"RPC",id:n,error:"NO_SUCH_METHOD"}):Promise.resolve().then(function(){return r.apply(null,e.params)}).then(function(t){o.postMessage({type:"RPC",id:n,result:t})}).catch(function(t){o.postMessage({type:"RPC",id:n,error:""+t})})}else{var a=s[n];if(null==a)throw Error("Unknown callback "+n);delete s[n],e.error?a[1](Error(e.error)):a[0](e.result)}})}function r(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n}s.getCanvas=r,s.convertImageDataToCanvasURL=function(t){var e=window.document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.putImageData(t,0,0),e.toDataURL()},s.applyFilter=function(t){var e=t.data,n=t.transform,i=t.options,s=t.nWorkers,c=function(t,e){var n,o,i,r=this,a={},s="__xpo"+Math.random().toString().substring(2)+"__";"function"==typeof t&&(t="("+Function.prototype.toString.call(t)+")("+s+")"),o=s,i=a,n=(n=(n=t).replace(/^(\s*)export\s+default\s+/m,function(t,e){return i.default=!0,""+e+o+".default="})).replace(/^(\s*)export\s+((?:async\s*)?function(?:\s*\*)?|const|let|var)(\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,function(t,e,n,r,a){return i[a]=!0,""+e+o+"."+a+"="+n+r+a}),t="var "+o+"={};\n"+n+"\n"+o+";\n("+Function.prototype.toString.call(h)+")(self,"+s+",{})";var c,u=URL.createObjectURL(new Blob([t])),l=new Worker(u,void 0),d=l.terminate,p={},f=0;for(c in l.kill=function(t){l.postMessage({type:"KILL",signal:t}),setTimeout(l.terminate)},l.terminate=function(){URL.revokeObjectURL(u),d.call(r)},l.call=function(r,a){return new Promise(function(t,e){var n="rpc"+ ++f;p[n]=[t,e],l.postMessage({type:"RPC",id:n,method:r,params:a})})},l.rpcMethods={},h(l,l.rpcMethods,p),l.expose=function(t){l[c]=function(){return l.call(t,[].slice.call(arguments))}},a)c in l||l.expose(c);return l}("\n        var transform = "+n+";\n\n        export function execute(canvas, index, length, options) {\n            canvas.data = transform({ \n                data: canvas.data, \n                length: length, \n                options: options\n            });\n\n            return { result: canvas, index: index };\n        }\n    "),u=r(e.width,e.height),l=u.getContext("2d");l.putImageData(e,0,0),s=s||1;var d=Math.floor(u.height/s);return new Promise(function(e){for(var n=0,t=void 0,r=0;r<s;r++){t=d,r+1===s&&(t=u.height-d*r);var a=l.getImageData(0,d*r,u.width,t),o=t*u.width*4;c.execute(a,r,o,i).then(function(t){l.putImageData(t.result,0,d*t.index),++n===s&&e(l.getImageData(0,0,u.width,u.height))})}})}}(),(a=r.exports).getCanvas,a.convertImageDataToCanvasURL,o=a.applyFilter,i=function(t){for(var e=t.data,n=t.length,r=0;r<n;r+=4){var a=.2126*e[r]+.7152*e[r+1]+.0722*e[r+2];e[r]=e[r+1]=e[r+2]=a}return e},n.transform=i,n.default=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.nWorkers;if(!e)throw new Error("lens-filter-grayscale:: invalid options provided");return o({data:e,transform:i,nWorkers:n})},Object.defineProperty(n,"__esModule",{value:!0})})),d=t(e(function(t,e){var n,r,a,o,i,s;n=e,s=(r={exports:{}}).exports,function(){function h(o,i,s){o.addEventListener("message",function(t){var e=t.data,n=e.id;if("RPC"===e.type&&null!=n)if(e.method){var r=i[e.method];null==r?o.postMessage({type:"RPC",id:n,error:"NO_SUCH_METHOD"}):Promise.resolve().then(function(){return r.apply(null,e.params)}).then(function(t){o.postMessage({type:"RPC",id:n,result:t})}).catch(function(t){o.postMessage({type:"RPC",id:n,error:""+t})})}else{var a=s[n];if(null==a)throw Error("Unknown callback "+n);delete s[n],e.error?a[1](Error(e.error)):a[0](e.result)}})}function r(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n}s.getCanvas=r,s.convertImageDataToCanvasURL=function(t){var e=window.document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.putImageData(t,0,0),e.toDataURL()},s.applyFilter=function(t){var e=t.data,n=t.transform,i=t.options,s=t.nWorkers,c=function(t,e){var n,o,i,r=this,a={},s="__xpo"+Math.random().toString().substring(2)+"__";"function"==typeof t&&(t="("+Function.prototype.toString.call(t)+")("+s+")"),o=s,i=a,n=(n=(n=t).replace(/^(\s*)export\s+default\s+/m,function(t,e){return i.default=!0,""+e+o+".default="})).replace(/^(\s*)export\s+((?:async\s*)?function(?:\s*\*)?|const|let|var)(\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,function(t,e,n,r,a){return i[a]=!0,""+e+o+"."+a+"="+n+r+a}),t="var "+o+"={};\n"+n+"\n"+o+";\n("+Function.prototype.toString.call(h)+")(self,"+s+",{})";var c,u=URL.createObjectURL(new Blob([t])),l=new Worker(u,void 0),d=l.terminate,p={},f=0;for(c in l.kill=function(t){l.postMessage({type:"KILL",signal:t}),setTimeout(l.terminate)},l.terminate=function(){URL.revokeObjectURL(u),d.call(r)},l.call=function(r,a){return new Promise(function(t,e){var n="rpc"+ ++f;p[n]=[t,e],l.postMessage({type:"RPC",id:n,method:r,params:a})})},l.rpcMethods={},h(l,l.rpcMethods,p),l.expose=function(t){l[c]=function(){return l.call(t,[].slice.call(arguments))}},a)c in l||l.expose(c);return l}("\n        var transform = "+n+";\n\n        export function execute(canvas, index, length, options) {\n            canvas.data = transform({ \n                data: canvas.data, \n                length: length, \n                options: options\n            });\n\n            return { result: canvas, index: index };\n        }\n    "),u=r(e.width,e.height),l=u.getContext("2d");l.putImageData(e,0,0),s=s||1;var d=Math.floor(u.height/s);return new Promise(function(e){for(var n=0,t=void 0,r=0;r<s;r++){t=d,r+1===s&&(t=u.height-d*r);var a=l.getImageData(0,d*r,u.width,t),o=t*u.width*4;c.execute(a,r,o,i).then(function(t){l.putImageData(t.result,0,d*t.index),++n===s&&e(l.getImageData(0,0,u.width,u.height))})}})}}(),(a=r.exports).getCanvas,a.convertImageDataToCanvasURL,o=a.applyFilter,i=function(t){for(var e=t.data,n=t.length,r=0;r<n;r+=4)e[r]=255-e[r],e[r+1]=255-e[r+1],e[r+2]=255-e[r+2];return e},n.transform=i,n.default=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.nWorkers;if(!e)throw new Error("lens-filter-invert:: invalid options provided");return o({data:e,transform:i,nWorkers:n})},Object.defineProperty(n,"__esModule",{value:!0})})),p=t(e(function(t,e){var n,r,a,o,i,s;n=e,s=(r={exports:{}}).exports,function(){function h(o,i,s){o.addEventListener("message",function(t){var e=t.data,n=e.id;if("RPC"===e.type&&null!=n)if(e.method){var r=i[e.method];null==r?o.postMessage({type:"RPC",id:n,error:"NO_SUCH_METHOD"}):Promise.resolve().then(function(){return r.apply(null,e.params)}).then(function(t){o.postMessage({type:"RPC",id:n,result:t})}).catch(function(t){o.postMessage({type:"RPC",id:n,error:""+t})})}else{var a=s[n];if(null==a)throw Error("Unknown callback "+n);delete s[n],e.error?a[1](Error(e.error)):a[0](e.result)}})}function r(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n}s.getCanvas=r,s.convertImageDataToCanvasURL=function(t){var e=window.document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.putImageData(t,0,0),e.toDataURL()},s.applyFilter=function(t){var e=t.data,n=t.transform,i=t.options,s=t.nWorkers,c=function(t,e){var n,o,i,r=this,a={},s="__xpo"+Math.random().toString().substring(2)+"__";"function"==typeof t&&(t="("+Function.prototype.toString.call(t)+")("+s+")"),o=s,i=a,n=(n=(n=t).replace(/^(\s*)export\s+default\s+/m,function(t,e){return i.default=!0,""+e+o+".default="})).replace(/^(\s*)export\s+((?:async\s*)?function(?:\s*\*)?|const|let|var)(\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,function(t,e,n,r,a){return i[a]=!0,""+e+o+"."+a+"="+n+r+a}),t="var "+o+"={};\n"+n+"\n"+o+";\n("+Function.prototype.toString.call(h)+")(self,"+s+",{})";var c,u=URL.createObjectURL(new Blob([t])),l=new Worker(u,void 0),d=l.terminate,p={},f=0;for(c in l.kill=function(t){l.postMessage({type:"KILL",signal:t}),setTimeout(l.terminate)},l.terminate=function(){URL.revokeObjectURL(u),d.call(r)},l.call=function(r,a){return new Promise(function(t,e){var n="rpc"+ ++f;p[n]=[t,e],l.postMessage({type:"RPC",id:n,method:r,params:a})})},l.rpcMethods={},h(l,l.rpcMethods,p),l.expose=function(t){l[c]=function(){return l.call(t,[].slice.call(arguments))}},a)c in l||l.expose(c);return l}("\n        var transform = "+n+";\n\n        export function execute(canvas, index, length, options) {\n            canvas.data = transform({ \n                data: canvas.data, \n                length: length, \n                options: options\n            });\n\n            return { result: canvas, index: index };\n        }\n    "),u=r(e.width,e.height),l=u.getContext("2d");l.putImageData(e,0,0),s=s||1;var d=Math.floor(u.height/s);return new Promise(function(e){for(var n=0,t=void 0,r=0;r<s;r++){t=d,r+1===s&&(t=u.height-d*r);var a=l.getImageData(0,d*r,u.width,t),o=t*u.width*4;c.execute(a,r,o,i).then(function(t){l.putImageData(t.result,0,d*t.index),++n===s&&e(l.getImageData(0,0,u.width,u.height))})}})}}(),(a=r.exports).getCanvas,a.convertImageDataToCanvasURL,o=a.applyFilter,i=function(t){for(var e=t.data,n=t.length,r=t.options,a=2.55*Math.abs(r.level),o=function(t,e){var n=t+e;return 255<n?255:n<0?0:n},i=0;i<n;i+=4){var s=(Math.random()<.5?-1:1)*(Math.random()+a);e[i]=o(e[i],s),e[i+1]=o(e[i+1],s),e[i+2]=o(e[i+2],s)}return e},n.transform=i,n.default=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.options,r=t.nWorkers;if(!e||!n||!n.level)throw new Error("lens-filter-noise:: invalid options provided");return o({data:e,transform:i,options:n,nWorkers:r})},Object.defineProperty(n,"__esModule",{value:!0})})),f=t(e(function(t,e){var n,r,a,o,i,s;n=e,s=(r={exports:{}}).exports,function(){function h(o,i,s){o.addEventListener("message",function(t){var e=t.data,n=e.id;if("RPC"===e.type&&null!=n)if(e.method){var r=i[e.method];null==r?o.postMessage({type:"RPC",id:n,error:"NO_SUCH_METHOD"}):Promise.resolve().then(function(){return r.apply(null,e.params)}).then(function(t){o.postMessage({type:"RPC",id:n,result:t})}).catch(function(t){o.postMessage({type:"RPC",id:n,error:""+t})})}else{var a=s[n];if(null==a)throw Error("Unknown callback "+n);delete s[n],e.error?a[1](Error(e.error)):a[0](e.result)}})}function r(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n}s.getCanvas=r,s.convertImageDataToCanvasURL=function(t){var e=window.document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.putImageData(t,0,0),e.toDataURL()},s.applyFilter=function(t){var e=t.data,n=t.transform,i=t.options,s=t.nWorkers,c=function(t,e){var n,o,i,r=this,a={},s="__xpo"+Math.random().toString().substring(2)+"__";"function"==typeof t&&(t="("+Function.prototype.toString.call(t)+")("+s+")"),o=s,i=a,n=(n=(n=t).replace(/^(\s*)export\s+default\s+/m,function(t,e){return i.default=!0,""+e+o+".default="})).replace(/^(\s*)export\s+((?:async\s*)?function(?:\s*\*)?|const|let|var)(\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,function(t,e,n,r,a){return i[a]=!0,""+e+o+"."+a+"="+n+r+a}),t="var "+o+"={};\n"+n+"\n"+o+";\n("+Function.prototype.toString.call(h)+")(self,"+s+",{})";var c,u=URL.createObjectURL(new Blob([t])),l=new Worker(u,void 0),d=l.terminate,p={},f=0;for(c in l.kill=function(t){l.postMessage({type:"KILL",signal:t}),setTimeout(l.terminate)},l.terminate=function(){URL.revokeObjectURL(u),d.call(r)},l.call=function(r,a){return new Promise(function(t,e){var n="rpc"+ ++f;p[n]=[t,e],l.postMessage({type:"RPC",id:n,method:r,params:a})})},l.rpcMethods={},h(l,l.rpcMethods,p),l.expose=function(t){l[c]=function(){return l.call(t,[].slice.call(arguments))}},a)c in l||l.expose(c);return l}("\n        var transform = "+n+";\n\n        export function execute(canvas, index, length, options) {\n            canvas.data = transform({ \n                data: canvas.data, \n                length: length, \n                options: options\n            });\n\n            return { result: canvas, index: index };\n        }\n    "),u=r(e.width,e.height),l=u.getContext("2d");l.putImageData(e,0,0),s=s||1;var d=Math.floor(u.height/s);return new Promise(function(e){for(var n=0,t=void 0,r=0;r<s;r++){t=d,r+1===s&&(t=u.height-d*r);var a=l.getImageData(0,d*r,u.width,t),o=t*u.width*4;c.execute(a,r,o,i).then(function(t){l.putImageData(t.result,0,d*t.index),++n===s&&e(l.getImageData(0,0,u.width,u.height))})}})}}(),(a=r.exports).getCanvas,a.convertImageDataToCanvasURL,o=a.applyFilter,i=function(t){for(var e=t.data,n=t.length,r=0;r<n;r+=4){var a=e[r],o=e[r+1],i=e[r+2];e[r]=.393*a+.769*o+.189*i,e[r+1]=.349*a+.686*o+.168*i,e[r+2]=.272*a+.534*o+.131*i}return e},n.transform=i,n.default=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.nWorkers;if(!e)throw new Error("lens-filter-sepia:: invalid options provided");return o({data:e,transform:i,nWorkers:n})},Object.defineProperty(n,"__esModule",{value:!0})})),h=t(e(function(t,e){var n,r,a,o,i,s;n=e,s=(r={exports:{}}).exports,function(){function h(o,i,s){o.addEventListener("message",function(t){var e=t.data,n=e.id;if("RPC"===e.type&&null!=n)if(e.method){var r=i[e.method];null==r?o.postMessage({type:"RPC",id:n,error:"NO_SUCH_METHOD"}):Promise.resolve().then(function(){return r.apply(null,e.params)}).then(function(t){o.postMessage({type:"RPC",id:n,result:t})}).catch(function(t){o.postMessage({type:"RPC",id:n,error:""+t})})}else{var a=s[n];if(null==a)throw Error("Unknown callback "+n);delete s[n],e.error?a[1](Error(e.error)):a[0](e.result)}})}function r(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n}s.getCanvas=r,s.convertImageDataToCanvasURL=function(t){var e=window.document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.putImageData(t,0,0),e.toDataURL()},s.applyFilter=function(t){var e=t.data,n=t.transform,i=t.options,s=t.nWorkers,c=function(t,e){var n,o,i,r=this,a={},s="__xpo"+Math.random().toString().substring(2)+"__";"function"==typeof t&&(t="("+Function.prototype.toString.call(t)+")("+s+")"),o=s,i=a,n=(n=(n=t).replace(/^(\s*)export\s+default\s+/m,function(t,e){return i.default=!0,""+e+o+".default="})).replace(/^(\s*)export\s+((?:async\s*)?function(?:\s*\*)?|const|let|var)(\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,function(t,e,n,r,a){return i[a]=!0,""+e+o+"."+a+"="+n+r+a}),t="var "+o+"={};\n"+n+"\n"+o+";\n("+Function.prototype.toString.call(h)+")(self,"+s+",{})";var c,u=URL.createObjectURL(new Blob([t])),l=new Worker(u,void 0),d=l.terminate,p={},f=0;for(c in l.kill=function(t){l.postMessage({type:"KILL",signal:t}),setTimeout(l.terminate)},l.terminate=function(){URL.revokeObjectURL(u),d.call(r)},l.call=function(r,a){return new Promise(function(t,e){var n="rpc"+ ++f;p[n]=[t,e],l.postMessage({type:"RPC",id:n,method:r,params:a})})},l.rpcMethods={},h(l,l.rpcMethods,p),l.expose=function(t){l[c]=function(){return l.call(t,[].slice.call(arguments))}},a)c in l||l.expose(c);return l}("\n        var transform = "+n+";\n\n        export function execute(canvas, index, length, options) {\n            canvas.data = transform({ \n                data: canvas.data, \n                length: length, \n                options: options\n            });\n\n            return { result: canvas, index: index };\n        }\n    "),u=r(e.width,e.height),l=u.getContext("2d");l.putImageData(e,0,0),s=s||1;var d=Math.floor(u.height/s);return new Promise(function(e){for(var n=0,t=void 0,r=0;r<s;r++){t=d,r+1===s&&(t=u.height-d*r);var a=l.getImageData(0,d*r,u.width,t),o=t*u.width*4;c.execute(a,r,o,i).then(function(t){l.putImageData(t.result,0,d*t.index),++n===s&&e(l.getImageData(0,0,u.width,u.height))})}})}}(),(a=r.exports).getCanvas,a.convertImageDataToCanvasURL,o=a.applyFilter,i=function(t){for(var e=t.data,n=t.length,r=t.options,a=0;a<n;a+=4){var o=.2126*e[a]+.7152*e[a+1]+.0722*e[a+2]>=r.level?255:0;e[a]=e[a+1]=e[a+2]=o}return e},n.transform=i,n.default=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.options,r=t.nWorkers;if(!e||!n||!n.level)throw new Error("lens-filter-threshold:: invalid options provided");return o({data:e,transform:i,options:n,nWorkers:r})},Object.defineProperty(n,"__esModule",{value:!0})}));function v(t){if(!t)throw new Error("lens-chainable:: no selector provided");var e=document.querySelectorAll(t)[0];if(!e)throw new Error('lens-chainable:: no "to" element found');return e}var g=function(){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}();var m={brightness:o,color:i,colorize:s,contrast:c,gamma:u,grayscale:l,invert:d,noise:p,sepia:f,threshold:h},w=function(t){if(t.data)return t.data;var e=function(t){if(t.url){var e=document.createElement("img");return e.setAttribute("src",t.url),e}return v(t.from)}(t),n=r(e.width,e.height);return function(t,e,n){if("IMG"!==n.tagName)throw new Error("lens-chainable:: invalid origin");return e.drawImage(n,0,0),e.getImageData(0,0,t.width,t.height)}(n,n.getContext("2d"),e)},x=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),!t.url&&!t.data&&!t.from)throw new Error("lens-chainable:: invalid options object");if(this.data=w(t),!this.data)throw new Error("lens-chainable:: no data found");this.filters=[],this.nWorkers=t.nWorkers,this.url=t.url,this.from=t.from}return g(e,[{key:"applyFilters",value:function(){var n=this,t=Promise.resolve(this.data);return this.filters.reduce(function(t,e){return t.then(function(t){return(0,m[e.filter])({data:t,options:e.options,nWorkers:n.nWorkers})})},t).then(function(t){return n.data=t})}},{key:"append",value:function(r){return this.applyFilters().then(function(t){var e=v(r),n=document.createElement("img");n.setAttribute("src",a(t)),e.appendChild(n)})}},{key:"update",value:function(e){return this.applyFilters().then(function(t){v(e).setAttribute("src",a(t))})}},{key:"getDataURL",value:function(){return a(this.data)}}]),e}();return Object.keys(m).forEach(function(e){x.prototype[e]=function(t){return this.filters.push({filter:e,options:t}),this}}),x});
//# sourceMappingURL=lens-chainable.umd.js.map

{"version":3,"file":"lens-core.umd.js","sources":["../node_modules/workerize/dist/workerize.m.js","../src/index.js"],"sourcesContent":["function e(e,t,n){e.addEventListener(\"message\",function(r){var o=r.data,a=o.id;if(\"RPC\"===o.type&&null!=a)if(o.method){var s=t[o.method];null==s?e.postMessage({type:\"RPC\",id:a,error:\"NO_SUCH_METHOD\"}):Promise.resolve().then(function(){return s.apply(null,o.params)}).then(function(t){e.postMessage({type:\"RPC\",id:a,result:t})}).catch(function(t){e.postMessage({type:\"RPC\",id:a,error:\"\"+t})})}else{var i=n[a];if(null==i)throw Error(\"Unknown callback \"+a);delete n[a],o.error?i[1](Error(o.error)):i[0](o.result)}})}export default function(t,n){var r=this,o={},a=\"__xpo\"+Math.random().toString().substring(2)+\"__\";\"function\"==typeof t&&(t=\"(\"+Function.prototype.toString.call(t)+\")(\"+a+\")\"),t=function(e,t,n){return e=(e=e.replace(/^(\\s*)export\\s+default\\s+/m,function(e,r){return n.default=!0,\"\"+r+t+\".default=\"})).replace(/^(\\s*)export\\s+((?:async\\s*)?function(?:\\s*\\*)?|const|let|var)(\\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,function(e,r,o,a,s){return n[s]=!0,\"\"+r+t+\".\"+s+\"=\"+o+a+s}),\"var \"+t+\"={};\\n\"+e+\"\\n\"+t+\";\"}(t,a,o)+\"\\n(\"+Function.prototype.toString.call(e)+\")(self,\"+a+\",{})\";var s,i=URL.createObjectURL(new Blob([t])),l=new Worker(i,n),c=l.terminate,u={},p=0;for(s in l.kill=function(e){l.postMessage({type:\"KILL\",signal:e}),setTimeout(l.terminate)},l.terminate=function(){URL.revokeObjectURL(i),c.call(r)},l.call=function(e,t){return new Promise(function(n,r){var o=\"rpc\"+ ++p;u[o]=[n,r],l.postMessage({type:\"RPC\",id:o,method:e,params:t})})},l.rpcMethods={},e(l,l.rpcMethods,u),l.expose=function(e){l[s]=function(){return l.call(e,[].slice.call(arguments))}},o)s in l||l.expose(s);return l};\n//# sourceMappingURL=workerize.m.js.map\n","import workerize from 'workerize';\n\n/**\n * It returns a canvas with the given width and height\n * @param {Number} w - width\n * @param {Number} h - height\n * @returns {Object}\n */\nfunction getCanvas(w, h) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h;\n\n    return canvas;\n}\n\n/**\n * Given a ImageData it returns the dataURL\n * @param {ImageData} imageData\n * @returns {String}\n */\nfunction convertImageDataToCanvasURL(imageData) {\n    const canvas = window.document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    canvas.width = imageData.width;\n    canvas.height = imageData.height;\n    ctx.putImageData(imageData, 0, 0);\n\n    return canvas.toDataURL();\n}\n\n/**\n * Given a worker file with the transformation the work is split\n * between the configured number of workers and the transformation is applied\n * returning a Promise\n * @param {Object} data - image data\n * @param {Function} transform - transformation function\n * @param {Object} options - object to be passed to the transform function\n * @param {Number} nWorkers - number of workers to transform the image\n * @returns {Promise}\n */\nfunction applyFilter({ data, transform, options, nWorkers }) {\n    const worker = workerize(`\n        var transform = ${transform};\n\n        export function execute(canvas, index, length, options) {\n            canvas.data = transform({ \n                data: canvas.data, \n                length: length, \n                options: options\n            });\n\n            return { result: canvas, index: index };\n        }\n    `);\n\n    // Drawing the source image into the target canvas\n    const canvas = getCanvas(data.width, data.height);\n    const context = canvas.getContext('2d');\n    context.putImageData(data, 0, 0);\n\n    // Minimium 1 worker\n    nWorkers = nWorkers || 1;\n\n    // Height of the picture chunck for every worker\n    const blockSize = Math.floor(canvas.height / nWorkers);\n\n    return new Promise(resolve => {\n        let finished = 0;\n        let height;\n\n        for (let index = 0; index < nWorkers; index++) {\n            // In the last worker we have to make sure we process whatever is missing\n            height = blockSize;\n\n            if (index + 1 === nWorkers) {\n                height = canvas.height - blockSize * index;\n            }\n\n            // Getting the picture\n            const canvasData = context.getImageData(\n                0,\n                blockSize * index,\n                canvas.width,\n                height\n            );\n            const length = height * canvas.width * 4;\n\n            worker\n                .execute(canvasData, index, length, options)\n                .then(response => {\n                    // Copying back canvas data to canvas\n                    // If the first webworker  (index 0) returns data, apply it at pixel (0, 0) onwards\n                    // If the second webworker  (index 1) returns data, apply it at pixel (0, canvas.height/4) onwards, and so on\n                    context.putImageData(\n                        response.result,\n                        0,\n                        blockSize * response.index\n                    );\n\n                    finished++;\n\n                    if (finished === nWorkers) {\n                        resolve(\n                            context.getImageData(\n                                0,\n                                0,\n                                canvas.width,\n                                canvas.height\n                            )\n                        );\n                    }\n                });\n        }\n    });\n}\n\nexports.getCanvas = getCanvas;\nexports.convertImageDataToCanvasURL = convertImageDataToCanvasURL;\nexports.applyFilter = applyFilter;\n"],"names":["getCanvas","w","h","canvas","document","createElement","width","height","convertImageDataToCanvasURL","imageData","window","ctx","getContext","putImageData","toDataURL","applyFilter","data","transform","options","nWorkers","worker","workerize","context","blockSize","Math","floor","Promise","finished","index","canvasData","getImageData","length","execute","then","response","result","resolve","exports"],"mappings":";;;;;;IAAA,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,gBAAgB,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,KAAK,GAAG,CAAC,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,EAAC,CAAC,EAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,EAAE,CAAC,CAAC,MAAM,KAAK,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,EAAC,CAAC,CAAC,EAAC,CAAC,AAAe,kBAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,4BAA4B,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,EAAE,OAAO,CAAC,iGAAiG,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,eAAe,CAAC,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,SAAS,EAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,IAAI,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;;ICE3jD;;;;;;IAMA,SAASA,SAAT,CAAmBC,CAAnB,EAAsBC,CAAtB,EAAyB;IACrB,QAAMC,SAASC,SAASC,aAAT,CAAuB,QAAvB,CAAf;IACAF,WAAOG,KAAP,GAAeL,CAAf;IACAE,WAAOI,MAAP,GAAgBL,CAAhB;;IAEA,WAAOC,MAAP;IACH;;IAED;;;;;IAKA,SAASK,2BAAT,CAAqCC,SAArC,EAAgD;IAC5C,QAAMN,SAASO,OAAON,QAAP,CAAgBC,aAAhB,CAA8B,QAA9B,CAAf;IACA,QAAMM,MAAMR,OAAOS,UAAP,CAAkB,IAAlB,CAAZ;IACAT,WAAOG,KAAP,GAAeG,UAAUH,KAAzB;IACAH,WAAOI,MAAP,GAAgBE,UAAUF,MAA1B;IACAI,QAAIE,YAAJ,CAAiBJ,SAAjB,EAA4B,CAA5B,EAA+B,CAA/B;;IAEA,WAAON,OAAOW,SAAP,EAAP;IACH;;IAED;;;;;;;;;;IAUA,SAASC,WAAT,OAA6D;IAAA,QAAtCC,IAAsC,QAAtCA,IAAsC;IAAA,QAAhCC,SAAgC,QAAhCA,SAAgC;IAAA,QAArBC,OAAqB,QAArBA,OAAqB;IAAA,QAAZC,QAAY,QAAZA,QAAY;;IACzD,QAAMC,SAASC,yCACOJ,SADP,uTAAf;;IAcA;IACA,QAAMd,SAASH,UAAUgB,KAAKV,KAAf,EAAsBU,KAAKT,MAA3B,CAAf;IACA,QAAMe,UAAUnB,OAAOS,UAAP,CAAkB,IAAlB,CAAhB;IACAU,YAAQT,YAAR,CAAqBG,IAArB,EAA2B,CAA3B,EAA8B,CAA9B;;IAEA;IACAG,eAAWA,YAAY,CAAvB;;IAEA;IACA,QAAMI,YAAYC,KAAKC,KAAL,CAAWtB,OAAOI,MAAP,GAAgBY,QAA3B,CAAlB;;IAEA,WAAO,IAAIO,OAAJ,CAAY,mBAAW;IAC1B,YAAIC,WAAW,CAAf;IACA,YAAIpB,eAAJ;;IAEA,aAAK,IAAIqB,QAAQ,CAAjB,EAAoBA,QAAQT,QAA5B,EAAsCS,OAAtC,EAA+C;IAC3C;IACArB,qBAASgB,SAAT;;IAEA,gBAAIK,QAAQ,CAAR,KAAcT,QAAlB,EAA4B;IACxBZ,yBAASJ,OAAOI,MAAP,GAAgBgB,YAAYK,KAArC;IACH;;IAED;IACA,gBAAMC,aAAaP,QAAQQ,YAAR,CACf,CADe,EAEfP,YAAYK,KAFG,EAGfzB,OAAOG,KAHQ,EAIfC,MAJe,CAAnB;IAMA,gBAAMwB,SAASxB,SAASJ,OAAOG,KAAhB,GAAwB,CAAvC;;IAEAc,mBACKY,OADL,CACaH,UADb,EACyBD,KADzB,EACgCG,MADhC,EACwCb,OADxC,EAEKe,IAFL,CAEU,oBAAY;IACd;IACA;IACA;IACAX,wBAAQT,YAAR,CACIqB,SAASC,MADb,EAEI,CAFJ,EAGIZ,YAAYW,SAASN,KAHzB;;IAMAD;;IAEA,oBAAIA,aAAaR,QAAjB,EAA2B;IACvBiB,4BACId,QAAQQ,YAAR,CACI,CADJ,EAEI,CAFJ,EAGI3B,OAAOG,KAHX,EAIIH,OAAOI,MAJX,CADJ;IAQH;IACJ,aAxBL;IAyBH;IACJ,KA/CM,CAAP;IAgDH;;IAED8B,QAAQrC,SAAR,GAAoBA,SAApB;IACAqC,QAAQ7B,2BAAR,GAAsCA,2BAAtC;IACA6B,QAAQtB,WAAR,GAAsBA,WAAtB;;;;"}
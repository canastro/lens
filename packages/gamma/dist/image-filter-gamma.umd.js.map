{"version":3,"file":"image-filter-gamma.umd.js","sources":["../../core/dist/image-filter-core.umd.js","../src/index.js"],"sourcesContent":["(function(global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined'\n        ? factory()\n        : typeof define === 'function' && define.amd\n            ? define(factory)\n            : factory();\n})(this, function() {\n    'use strict';\n\n    function e(e, t, n) {\n        e.addEventListener('message', function(r) {\n            var o = r.data,\n                a = o.id;\n            if ('RPC' === o.type && null != a)\n                if (o.method) {\n                    var s = t[o.method];\n                    null == s\n                        ? e.postMessage({\n                              type: 'RPC',\n                              id: a,\n                              error: 'NO_SUCH_METHOD'\n                          })\n                        : Promise.resolve()\n                              .then(function() {\n                                  return s.apply(null, o.params);\n                              })\n                              .then(function(t) {\n                                  e.postMessage({\n                                      type: 'RPC',\n                                      id: a,\n                                      result: t\n                                  });\n                              })\n                              .catch(function(t) {\n                                  e.postMessage({\n                                      type: 'RPC',\n                                      id: a,\n                                      error: '' + t\n                                  });\n                              });\n                } else {\n                    var i = n[a];\n                    if (null == i) throw Error('Unknown callback ' + a);\n                    delete n[a],\n                        o.error ? i[1](Error(o.error)) : i[0](o.result);\n                }\n        });\n    }\n    function workerize(t, n) {\n        var r = this,\n            o = {},\n            a =\n                '__xpo' +\n                Math.random()\n                    .toString()\n                    .substring(2) +\n                '__';\n        'function' == typeof t &&\n            (t = '(' + Function.prototype.toString.call(t) + ')(' + a + ')'),\n            (t =\n                (function(e, t, n) {\n                    return (\n                        (e = (e = e.replace(\n                            /^(\\s*)export\\s+default\\s+/m,\n                            function(e, r) {\n                                return (\n                                    (n.default = !0), '' + r + t + '.default='\n                                );\n                            }\n                        )).replace(\n                            /^(\\s*)export\\s+((?:async\\s*)?function(?:\\s*\\*)?|const|let|var)(\\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,\n                            function(e, r, o, a, s) {\n                                return (\n                                    (n[s] = !0),\n                                    '' + r + t + '.' + s + '=' + o + a + s\n                                );\n                            }\n                        )),\n                        'var ' + t + '={};\\n' + e + '\\n' + t + ';'\n                    );\n                })(t, a, o) +\n                '\\n(' +\n                Function.prototype.toString.call(e) +\n                ')(self,' +\n                a +\n                ',{})');\n        var s,\n            i = URL.createObjectURL(new Blob([t])),\n            l = new Worker(i, n),\n            c = l.terminate,\n            u = {},\n            p = 0;\n        for (s in ((l.kill = function(e) {\n            l.postMessage({ type: 'KILL', signal: e }), setTimeout(l.terminate);\n        }),\n        (l.terminate = function() {\n            URL.revokeObjectURL(i), c.call(r);\n        }),\n        (l.call = function(e, t) {\n            return new Promise(function(n, r) {\n                var o = 'rpc' + ++p;\n                (u[o] = [n, r]),\n                    l.postMessage({ type: 'RPC', id: o, method: e, params: t });\n            });\n        }),\n        (l.rpcMethods = {}),\n        e(l, l.rpcMethods, u),\n        (l.expose = function(e) {\n            l[s] = function() {\n                return l.call(e, [].slice.call(arguments));\n            };\n        }),\n        o))\n            s in l || l.expose(s);\n        return l;\n    }\n\n    /**\n     * It returns a canvas with the given width and height\n     * @param {Number} w - width\n     * @param {Number} h - height\n     * @returns {Object}\n     */\n    function getCanvas(w, h) {\n        var canvas = document.createElement('canvas');\n        canvas.width = w;\n        canvas.height = h;\n\n        return canvas;\n    }\n\n    /**\n     * Given a ImageData it returns the dataURL\n     * @param {ImageData} imageData\n     * @returns {String}\n     */\n    function convertImageDataToCanvasURL(imageData) {\n        var canvas = window.document.createElement('canvas');\n        var ctx = canvas.getContext('2d');\n        canvas.width = imageData.width;\n        canvas.height = imageData.height;\n        ctx.putImageData(imageData, 0, 0);\n\n        return canvas.toDataURL();\n    }\n\n    /**\n     * Given a worker file with the transformation the work is split\n     * between the configured number of workers and the transformation is applied\n     * returning a Promise\n     * @param {Object} data - image data\n     * @param {Function} transform - transformation function\n     * @param {Object} options - object to be passed to the transform function\n     * @param {Number} nWorkers - number of workers to transform the image\n     * @returns {Promise}\n     */\n    function applyFilter(data, transform, options, nWorkers) {\n        var worker = workerize(\n            '\\n        var transform = ' +\n                transform +\n                ';\\n\\n        export function execute(canvas, index, length, options) {\\n            transform(canvas.data, length, options);\\n            return { result: canvas, index };\\n        }\\n    '\n        );\n\n        // Drawing the source image into the target canvas\n        var canvas = getCanvas(data.width, data.height);\n        var context = canvas.getContext('2d');\n        context.putImageData(data, 0, 0);\n\n        // Minimium 1 worker\n        nWorkers = nWorkers || 1;\n\n        // Height of the picture chunck for every worker\n        var blockSize = Math.floor(canvas.height / nWorkers);\n\n        return new Promise(function(resolve) {\n            var finished = 0;\n            var height = void 0;\n\n            for (var index = 0; index < nWorkers; index++) {\n                // In the last worker we have to make sure we process whatever is missing\n                height = blockSize;\n\n                if (index + 1 === nWorkers) {\n                    height = canvas.height - blockSize * index;\n                }\n\n                // Getting the picture\n                var canvasData = context.getImageData(\n                    0,\n                    blockSize * index,\n                    canvas.width,\n                    height\n                );\n                var length = height * canvas.width * 4;\n\n                worker\n                    .execute(canvasData, index, length, options)\n                    .then(function(response) {\n                        // Copying back canvas data to canvas\n                        // If the first webworker  (index 0) returns data, apply it at pixel (0, 0) onwards\n                        // If the second webworker  (index 1) returns data, apply it at pixel (0, canvas.height/4) onwards, and so on\n                        context.putImageData(\n                            response.result,\n                            0,\n                            blockSize * response.index\n                        );\n\n                        finished++;\n\n                        if (finished === nWorkers) {\n                            resolve(\n                                context.getImageData(\n                                    0,\n                                    0,\n                                    canvas.width,\n                                    canvas.height\n                                )\n                            );\n                        }\n                    });\n            }\n        });\n    }\n\n    module.exports = {\n        applyFilter: applyFilter,\n        convertImageDataToCanvasURL: convertImageDataToCanvasURL,\n        getCanvas: getCanvas\n    };\n});\n//# sourceMappingURL=image-filter-core.umd.js.map\n","import { applyFilter } from 'image-filter-core';\n\n/**\n * Iterate over the array applying the gamma transformation\n * @param {Object} data\n * @param {Number} length\n * @param {Object} options\n * @param {Number} [options.adjustment]\n */\nexport const transform = (data, length, options) => {\n    for (let i = 0; i < length; i += 4) {\n        data[i] = Math.pow(data[i] / 255, options.adjustment) * 255;\n        data[i + 1] = Math.pow(data[i + 1] / 255, options.adjustment) * 255;\n        data[i + 2] = Math.pow(data[i + 2] / 255, options.adjustment) * 255;\n    }\n};\n\n\n/**\n * @param {ImageData} data - data of a image extracted from a canvas\n * @param {Object} options - options to pass to the transformation function\n * @param {Number} [options.adjustment] - adjustment to apply in the transformation\n * @param {Number} nWorkers - number of workers\n * @returns {Promise}\n */\nexport default function gamma(data, options, nWorkers) {\n    if (!data || !options || !options.adjustment) {\n        throw new Error('image-filter-gamma:: invalid options provided');\n    }\n\n    return applyFilter(data, transform, options, nWorkers);\n}\n"],"names":["global","factory","this","e","t","n","addEventListener","r","o","data","a","id","type","method","s","postMessage","error","Promise","resolve","then","apply","params","result","catch","i","Error","workerize","Math","random","toString","substring","Function","prototype","call","replace","default","URL","createObjectURL","Blob","l","Worker","c","terminate","u","p","kill","signal","setTimeout","revokeObjectURL","rpcMethods","expose","slice","arguments","getCanvas","w","h","canvas","document","createElement","width","height","convertImageDataToCanvasURL","imageData","window","ctx","getContext","putImageData","toDataURL","applyFilter","transform","options","nWorkers","worker","context","blockSize","floor","finished","index","canvasData","getImageData","length","execute","response","module","pow","adjustment","gamma"],"mappings":"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"}
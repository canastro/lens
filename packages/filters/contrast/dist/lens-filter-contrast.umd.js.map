{"version":3,"file":"lens-filter-contrast.umd.js","sources":["../../../core/dist/lens-core.umd.js","../src/index.js"],"sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory() :\n    typeof define === 'function' && define.amd ? define(factory) :\n    (factory());\n}(this, (function () { 'use strict';\n\n    function e(e,t,n){e.addEventListener(\"message\",function(r){var o=r.data,a=o.id;if(\"RPC\"===o.type&&null!=a)if(o.method){var s=t[o.method];null==s?e.postMessage({type:\"RPC\",id:a,error:\"NO_SUCH_METHOD\"}):Promise.resolve().then(function(){return s.apply(null,o.params)}).then(function(t){e.postMessage({type:\"RPC\",id:a,result:t});}).catch(function(t){e.postMessage({type:\"RPC\",id:a,error:\"\"+t});});}else{var i=n[a];if(null==i)throw Error(\"Unknown callback \"+a);delete n[a],o.error?i[1](Error(o.error)):i[0](o.result);}});}function workerize(t,n){var r=this,o={},a=\"__xpo\"+Math.random().toString().substring(2)+\"__\";\"function\"==typeof t&&(t=\"(\"+Function.prototype.toString.call(t)+\")(\"+a+\")\"),t=function(e,t,n){return e=(e=e.replace(/^(\\s*)export\\s+default\\s+/m,function(e,r){return n.default=!0,\"\"+r+t+\".default=\"})).replace(/^(\\s*)export\\s+((?:async\\s*)?function(?:\\s*\\*)?|const|let|var)(\\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,function(e,r,o,a,s){return n[s]=!0,\"\"+r+t+\".\"+s+\"=\"+o+a+s}),\"var \"+t+\"={};\\n\"+e+\"\\n\"+t+\";\"}(t,a,o)+\"\\n(\"+Function.prototype.toString.call(e)+\")(self,\"+a+\",{})\";var s,i=URL.createObjectURL(new Blob([t])),l=new Worker(i,n),c=l.terminate,u={},p=0;for(s in l.kill=function(e){l.postMessage({type:\"KILL\",signal:e}),setTimeout(l.terminate);},l.terminate=function(){URL.revokeObjectURL(i),c.call(r);},l.call=function(e,t){return new Promise(function(n,r){var o=\"rpc\"+ ++p;u[o]=[n,r],l.postMessage({type:\"RPC\",id:o,method:e,params:t});})},l.rpcMethods={},e(l,l.rpcMethods,u),l.expose=function(e){l[s]=function(){return l.call(e,[].slice.call(arguments))};},o)s in l||l.expose(s);return l}\n\n    /**\n     * It returns a canvas with the given width and height\n     * @param {Number} w - width\n     * @param {Number} h - height\n     * @returns {Object}\n     */\n    function getCanvas(w, h) {\n        var canvas = document.createElement('canvas');\n        canvas.width = w;\n        canvas.height = h;\n\n        return canvas;\n    }\n\n    /**\n     * Given a ImageData it returns the dataURL\n     * @param {ImageData} imageData\n     * @returns {String}\n     */\n    function convertImageDataToCanvasURL(imageData) {\n        var canvas = window.document.createElement('canvas');\n        var ctx = canvas.getContext('2d');\n        canvas.width = imageData.width;\n        canvas.height = imageData.height;\n        ctx.putImageData(imageData, 0, 0);\n\n        return canvas.toDataURL();\n    }\n\n    /**\n     * Given a worker file with the transformation the work is split\n     * between the configured number of workers and the transformation is applied\n     * returning a Promise\n     * @param {Object} data - image data\n     * @param {Function} transform - transformation function\n     * @param {Object} options - object to be passed to the transform function\n     * @param {Number} nWorkers - number of workers to transform the image\n     * @returns {Promise}\n     */\n    function applyFilter(_ref) {\n        var data = _ref.data,\n            transform = _ref.transform,\n            options = _ref.options,\n            nWorkers = _ref.nWorkers;\n\n        var worker = workerize('\\n        var transform = ' + transform + ';\\n\\n        export function execute(canvas, index, length, options) {\\n            canvas.data = transform({ \\n                data: canvas.data, \\n                length: length, \\n                options: options\\n            });\\n\\n            return { result: canvas, index: index };\\n        }\\n    ');\n\n        // Drawing the source image into the target canvas\n        var canvas = getCanvas(data.width, data.height);\n        var context = canvas.getContext('2d');\n        context.putImageData(data, 0, 0);\n\n        // Minimium 1 worker\n        nWorkers = nWorkers || 1;\n\n        // Height of the picture chunck for every worker\n        var blockSize = Math.floor(canvas.height / nWorkers);\n\n        return new Promise(function (resolve) {\n            var finished = 0;\n            var height = void 0;\n\n            for (var index = 0; index < nWorkers; index++) {\n                // In the last worker we have to make sure we process whatever is missing\n                height = blockSize;\n\n                if (index + 1 === nWorkers) {\n                    height = canvas.height - blockSize * index;\n                }\n\n                // Getting the picture\n                var canvasData = context.getImageData(0, blockSize * index, canvas.width, height);\n                var length = height * canvas.width * 4;\n\n                worker.execute(canvasData, index, length, options).then(function (response) {\n                    // Copying back canvas data to canvas\n                    // If the first webworker  (index 0) returns data, apply it at pixel (0, 0) onwards\n                    // If the second webworker  (index 1) returns data, apply it at pixel (0, canvas.height/4) onwards, and so on\n                    context.putImageData(response.result, 0, blockSize * response.index);\n\n                    finished++;\n\n                    if (finished === nWorkers) {\n                        resolve(context.getImageData(0, 0, canvas.width, canvas.height));\n                    }\n                });\n            }\n        });\n    }\n\n    exports.getCanvas = getCanvas;\n    exports.convertImageDataToCanvasURL = convertImageDataToCanvasURL;\n    exports.applyFilter = applyFilter;\n\n})));\n//# sourceMappingURL=lens-core.umd.js.map\n","import { applyFilter } from 'lens-core';\n\n/**\n * Iterate over the array applying the contrast transformation\n * @name transform\n * @param {Object} data\n * @param {Number} length\n * @param {Object} options\n * @param {Number} [options.contrast]\n */\nexport const transform = ({ data, length, options }) => {\n    const factor =\n        (259 * (options.contrast + 255)) / (255 * (259 - options.contrast));\n\n    for (let i = 0; i < length; i += 4) {\n        data[i] = factor * (data[i] - 128) + 128;\n        data[i + 1] = factor * (data[i + 1] - 128) + 128;\n        data[i + 2] = factor * (data[i + 2] - 128) + 128;\n    }\n\n    return data;\n};\n\n/**\n * @param {ImageData} data - data of a image extracted from a canvas\n * @param {Object} options - options to pass to the transformation function\n * @param {Number} [options.contrast] - contrast value to apply in the transformation\n * @param {Number} nWorkers - number of workers\n * @returns {Promise}\n */\nexport default function contrast({ data, options, nWorkers } = {}) {\n    if (!data || !options || !options.contrast) {\n        throw new Error('lens-filter-contrast:: invalid options provided');\n    }\n\n    return applyFilter({ data, transform, options, nWorkers });\n}\n"],"names":["global","factory","this","e","t","n","addEventListener","r","o","data","a","id","type","method","s","postMessage","error","Promise","resolve","then","apply","params","result","catch","i","Error","workerize","Math","random","toString","substring","Function","prototype","call","replace","default","URL","createObjectURL","Blob","l","Worker","c","terminate","u","p","kill","signal","setTimeout","revokeObjectURL","rpcMethods","expose","slice","arguments","getCanvas","w","h","canvas","document","createElement","width","height","convertImageDataToCanvasURL","imageData","window","ctx","getContext","putImageData","toDataURL","applyFilter","_ref","transform","options","nWorkers","worker","context","blockSize","floor","finished","index","canvasData","getImageData","length","execute","response","exports","factor","contrast"],"mappings":"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"}
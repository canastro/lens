{"version":3,"file":"lens-filter-gamma.umd.js","sources":["../../../core/dist/lens-core.umd.js","../src/index.js"],"sourcesContent":["!function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?e():\"function\"==typeof define&&define.amd?define(e):e()}(0,function(){\"use strict\";function h(o,i,s){o.addEventListener(\"message\",function(t){var e=t.data,n=e.id;if(\"RPC\"===e.type&&null!=n)if(e.method){var r=i[e.method];null==r?o.postMessage({type:\"RPC\",id:n,error:\"NO_SUCH_METHOD\"}):Promise.resolve().then(function(){return r.apply(null,e.params)}).then(function(t){o.postMessage({type:\"RPC\",id:n,result:t})}).catch(function(t){o.postMessage({type:\"RPC\",id:n,error:\"\"+t})})}else{var a=s[n];if(null==a)throw Error(\"Unknown callback \"+n);delete s[n],e.error?a[1](Error(e.error)):a[0](e.result)}})}function r(t,e){var n=document.createElement(\"canvas\");return n.width=t,n.height=e,n}exports.getCanvas=r,exports.convertImageDataToCanvasURL=function(t){var e=window.document.createElement(\"canvas\"),n=e.getContext(\"2d\");return e.width=t.width,e.height=t.height,n.putImageData(t,0,0),e.toDataURL()},exports.applyFilter=function(t){var e=t.data,n=t.transform,i=t.options,s=t.nWorkers,c=function(t,e){var n,o,i,r=this,a={},s=\"__xpo\"+Math.random().toString().substring(2)+\"__\";\"function\"==typeof t&&(t=\"(\"+Function.prototype.toString.call(t)+\")(\"+s+\")\"),o=s,i=a,n=(n=(n=t).replace(/^(\\s*)export\\s+default\\s+/m,function(t,e){return i.default=!0,\"\"+e+o+\".default=\"})).replace(/^(\\s*)export\\s+((?:async\\s*)?function(?:\\s*\\*)?|const|let|var)(\\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,function(t,e,n,r,a){return i[a]=!0,\"\"+e+o+\".\"+a+\"=\"+n+r+a}),t=\"var \"+o+\"={};\\n\"+n+\"\\n\"+o+\";\\n(\"+Function.prototype.toString.call(h)+\")(self,\"+s+\",{})\";var c,u=URL.createObjectURL(new Blob([t])),l=new Worker(u,e),p=l.terminate,d={},f=0;for(c in l.kill=function(t){l.postMessage({type:\"KILL\",signal:t}),setTimeout(l.terminate)},l.terminate=function(){URL.revokeObjectURL(u),p.call(r)},l.call=function(r,a){return new Promise(function(t,e){var n=\"rpc\"+ ++f;d[n]=[t,e],l.postMessage({type:\"RPC\",id:n,method:r,params:a})})},l.rpcMethods={},h(l,l.rpcMethods,d),l.expose=function(t){l[c]=function(){return l.call(t,[].slice.call(arguments))}},a)c in l||l.expose(c);return l}(\"\\n        var transform = \"+n+\";\\n\\n        export function execute(canvas, index, length, options) {\\n            canvas.data = transform({ \\n                data: canvas.data, \\n                length: length, \\n                options: options\\n            });\\n\\n            return { result: canvas, index: index };\\n        }\\n    \"),u=r(e.width,e.height),l=u.getContext(\"2d\");l.putImageData(e,0,0),s=s||1;var p=Math.floor(u.height/s);return new Promise(function(e){for(var n=0,t=void 0,r=0;r<s;r++){t=p,r+1===s&&(t=u.height-p*r);var a=l.getImageData(0,p*r,u.width,t),o=t*u.width*4;c.execute(a,r,o,i).then(function(t){l.putImageData(t.result,0,p*t.index),++n===s&&e(l.getImageData(0,0,u.width,u.height))})}})}});\n//# sourceMappingURL=lens-core.umd.js.map\n","import { applyFilter } from 'lens-core';\n\n/**\n * Iterate over the array applying the gamma transformation\n * @param {Object} data\n * @param {Number} length\n * @param {Object} options\n * @param {Number} [options.level]\n */\nexport const transform = ({ data, length, options }) => {\n    for (let i = 0; i < length; i += 4) {\n        data[i] = Math.pow(data[i] / 255, options.level) * 255;\n        data[i + 1] = Math.pow(data[i + 1] / 255, options.level) * 255;\n        data[i + 2] = Math.pow(data[i + 2] / 255, options.level) * 255;\n    }\n\n    return data;\n};\n\n/**\n * @param {ImageData} data - data of a image extracted from a canvas\n * @param {Object} options - options to pass to the transformation function\n * @param {Number} [options.level] - level to apply in the transformation\n * @param {Number} nWorkers - number of workers\n * @returns {Promise}\n */\nexport default function gamma({ data, options, nWorkers } = {}) {\n    if (!data || !options || !options.level) {\n        throw new Error('lens-filter-gamma:: invalid options provided');\n    }\n\n    return applyFilter({ data, transform, options, nWorkers });\n}\n"],"names":["h","o","i","s","addEventListener","t","e","data","n","id","type","method","r","postMessage","error","Promise","resolve","then","apply","params","result","catch","a","Error","document","createElement","width","height","exports","window","getContext","putImageData","toDataURL","transform","options","nWorkers","c","this","Math","random","toString","substring","Function","prototype","call","replace","default","u","URL","createObjectURL","Blob","l","Worker","p","terminate","d","f","kill","signal","setTimeout","revokeObjectURL","rpcMethods","expose","slice","arguments","floor","getImageData","execute","index","length","pow","level","applyFilter"],"mappings":"0NAA+H,oBAAiCA,EAAEC,EAAEC,EAAEC,KAAKC,iBAAiB,UAAU,SAASC,OAAOC,EAAED,EAAEE,KAAKC,EAAEF,EAAEG,GAAG,GAAG,QAAQH,EAAEI,MAAM,MAAMF,EAAE,GAAGF,EAAEK,OAAO,KAAKC,EAAEV,EAAEI,EAAEK,QAAQ,MAAMC,EAAEX,EAAEY,YAAY,CAACH,KAAK,MAAMD,GAAGD,EAAEM,MAAM,mBAAmBC,QAAQC,UAAUC,KAAK,kBAAkBL,EAAEM,MAAM,KAAKZ,EAAEa,UAAUF,KAAK,SAASZ,KAAKQ,YAAY,CAACH,KAAK,MAAMD,GAAGD,EAAEY,OAAOf,MAAMgB,MAAM,SAAShB,KAAKQ,YAAY,CAACH,KAAK,MAAMD,GAAGD,EAAEM,MAAM,GAAGT,UAAU,KAAKiB,EAAEnB,EAAEK,GAAG,GAAG,MAAMc,EAAE,MAAMC,MAAM,oBAAoBf,UAAUL,EAAEK,GAAGF,EAAEQ,MAAMQ,EAAE,GAAGC,MAAMjB,EAAEQ,QAAQQ,EAAE,GAAGhB,EAAEc,oBAAoBR,EAAEP,EAAEC,OAAOE,EAAEgB,SAASC,cAAc,UAAU,OAAOjB,EAAEkB,MAAMrB,EAAEG,EAAEmB,OAAOrB,EAAEE,cAAoBI,EAAEgB,8BAAoC,SAASvB,OAAOC,EAAEuB,OAAOL,SAASC,cAAc,UAAUjB,EAAEF,EAAEwB,WAAW,MAAM,OAAOxB,EAAEoB,MAAMrB,EAAEqB,MAAMpB,EAAEqB,OAAOtB,EAAEsB,OAAOnB,EAAEuB,aAAa1B,EAAE,EAAE,GAAGC,EAAE0B,aAAaJ,cAAoB,SAASvB,OAAOC,EAAED,EAAEE,KAAKC,EAAEH,EAAE4B,UAAU/B,EAAEG,EAAE6B,QAAQ/B,EAAEE,EAAE8B,SAASC,EAAE,SAAS/B,EAAEC,OAAOE,EAAEP,EAAEC,EAAEU,EAAEyB,KAAKf,EAAE,GAAGnB,EAAE,QAAQmC,KAAKC,SAASC,WAAWC,UAAU,GAAG,KAAK,mBAAmBpC,IAAIA,EAAE,IAAIqC,SAASC,UAAUH,SAASI,KAAKvC,GAAG,KAAKF,EAAE,KAAKF,EAAEE,EAAED,EAAEoB,EAAEd,GAAGA,GAAGA,EAAEH,GAAGwC,QAAQ,6BAA6B,SAASxC,EAAEC,UAAUJ,EAAE4C,SAAQ,EAAG,GAAGxC,EAAEL,EAAE,eAAe4C,QAAQ,kGAAkG,SAASxC,EAAEC,EAAEE,EAAEI,EAAEU,UAAUpB,EAAEoB,IAAG,EAAG,GAAGhB,EAAEL,EAAE,IAAIqB,EAAE,IAAId,EAAEI,EAAEU,IAAIjB,EAAE,OAAOJ,EAAE,SAASO,EAAE,KAAKP,EAAE,OAAOyC,SAASC,UAAUH,SAASI,KAAK5C,GAAG,UAAUG,EAAE,OAAO,IAAIiC,EAAEW,EAAEC,IAAIC,gBAAgB,IAAIC,KAAK,CAAC7C,KAAK8C,EAAE,IAAIC,OAAOL,OAA/kB,GAAolBM,EAAEF,EAAEG,UAAUC,EAAE,GAAGC,EAAE,EAAE,IAAIpB,KAAKe,EAAEM,KAAK,SAASpD,KAAKQ,YAAY,CAACH,KAAK,OAAOgD,OAAOrD,IAAIsD,WAAWR,EAAEG,YAAYH,EAAEG,UAAU,eAAeM,gBAAgBb,GAAGM,EAAET,KAAKhC,IAAIuC,EAAEP,KAAK,SAAShC,EAAEU,UAAU,IAAIP,QAAQ,SAASV,EAAEC,OAAOE,EAAE,SAASgD,EAAED,EAAE/C,GAAG,CAACH,EAAEC,GAAG6C,EAAEtC,YAAY,CAACH,KAAK,MAAMD,GAAGD,EAAEG,OAAOC,EAAEO,OAAOG,OAAO6B,EAAEU,WAAW,GAAG7D,EAAEmD,EAAEA,EAAEU,WAAWN,GAAGJ,EAAEW,OAAO,SAASzD,KAAK+B,GAAG,kBAAkBe,EAAEP,KAAKvC,EAAE,GAAG0D,MAAMnB,KAAKoB,cAAc1C,OAAO6B,GAAGA,EAAEW,OAAO1B,GAAG,OAAOe,EAAzhC,CAA4hC,6BAA6B3C,EAAE,qTAAqTuC,EAAEnC,EAAEN,EAAEoB,MAAMpB,EAAEqB,QAAQwB,EAAEJ,EAAEjB,WAAW,MAAMqB,EAAEpB,aAAazB,EAAE,EAAE,GAAGH,EAAEA,GAAG,EAAE,IAAIkD,EAAEf,KAAK2B,MAAMlB,EAAEpB,OAAOxB,GAAG,OAAO,IAAIY,QAAQ,SAAST,OAAO,IAAIE,EAAE,EAAEH,OAAE,EAAOO,EAAE,EAAEA,EAAET,EAAES,IAAI,GAAGyC,EAAEzC,EAAE,IAAIT,IAAIE,EAAE0C,EAAEpB,OAAO0B,EAAEzC,GAAG,IAAIU,EAAE6B,EAAEe,aAAa,EAAEb,EAAEzC,EAAEmC,EAAErB,MAAMrB,GAAGJ,EAAEI,EAAE0C,EAAErB,MAAM,EAAEU,EAAE+B,QAAQ7C,EAAEV,EAAEX,EAAEC,GAAGe,KAAK,SAASZ,KAAK0B,aAAa1B,EAAEe,OAAO,EAAEiC,EAAEhD,EAAE+D,SAAS5D,IAAIL,GAAGG,EAAE6C,EAAEe,aAAa,EAAE,EAAEnB,EAAErB,MAAMqB,EAAEpB,oHCSpuFM,EAAY,oBAAG1B,IAAAA,KAAM8D,IAAAA,OAAQnC,IAAAA,QAC7BhC,EAAI,EAAGA,EAAImE,EAAQnE,GAAK,IACxBA,GAA8C,IAAzCoC,KAAKgC,IAAI/D,EAAKL,GAAK,IAAKgC,EAAQqC,SACrCrE,EAAI,GAAkD,IAA7CoC,KAAKgC,IAAI/D,EAAKL,EAAI,GAAK,IAAKgC,EAAQqC,SAC7CrE,EAAI,GAAkD,IAA7CoC,KAAKgC,IAAI/D,EAAKL,EAAI,GAAK,IAAKgC,EAAQqC,cAG/ChE,2BAUI,wEAA6C,GAA5BA,IAAAA,KAAM2B,IAAAA,QAASC,IAAAA,aACtC5B,IAAS2B,IAAYA,EAAQqC,YACxB,IAAIhD,MAAM,uDAGbiD,EAAY,CAAEjE,OAAM0B,YAAWC,UAASC"}